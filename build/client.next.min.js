/*!
 * tiny-msg-client - version 0.4.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2016 Steve Ottoz
 */
export default class Msg{constructor(a,b,c,d=this,f=''){this.url=f,this.channel=a,this.onmsg=b,this.onerror=c,this.context=d,this.q=[],init.call(this)}send(a){try{a=JSON.stringify(a)}catch(b){}if(1===this.ws.readyState)try{this.ws.send(a)}catch(b){this.q.push(a)}else this.q.push(a)}}function init(){WebSocket&&(this.ws=new WebSocket(this.url,this.channel),this.ws.onopen=onopen.bind(this),this.ws.onmessage=onmessage.bind(this),this.ws.onerror=onerror.bind(this),this.ws.onclose=onclose.bind(this))}function onopen(a){for(;this.q.length;)try{this.ws.send(this.q.shift())}catch(b){}}function onmessage(a){let b=a.data;try{b=JSON.parse(b)}catch(c){}/^f/.test(typeof this.onmsg)&&this.onmsg.apply(this.context,[b,a,this])}function onerror(a){/^f/.test(typeof this.onerror)&&this.onerror.apply(this.context,[a,this])}function onclose(a){clearTimeout(this.timeout),this.timeout=setTimeout(this._init.bind(this),5000)}