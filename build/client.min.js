/*!
 * tiny-msg-client - Version 0.3.1
 * client for tiny real-time messaging server
 * Author: Steve Ottoz <so@dev.so>
 * Build date: 2016-08-04
 * Copyright (c) 2016 Steve Ottoz
 * Released under the MIT license
 */
!function(a,b){"use strict";/^f/.test(typeof define)&&define.amd?define("msg",[],b):/^o/.test(typeof exports)?module.exports=b():a.Msg=b()}(/^u/.test(typeof window)?this:window,function(){"use strict";var a=function(a,b,c,d,e){this.url=e||"",this.channel=a,this.onmsg=b,this.onerror=c,this.context=d||this,this.q=[],this._init()};return a.prototype={_init:function(){if(WebSocket){var a=this;a.ws=new WebSocket(a.url,a.channel),a.ws.onopen=a._open.bind(a),a.ws.onmessage=a._message.bind(a),a.ws.onerror=a._error.bind(a),a.ws.onclose=a._close.bind(a)}},_open:function(a){for(var b=this;b.q.length;)try{b.ws.send(b.q.shift())}catch(a){}},_message:function(a){var b=a.data;try{b=JSON.parse(b)}catch(a){}/^f/.test(typeof this.onmsg)&&this.onmsg.apply(this.context,[b,a,this])},_error:function(a){/^f/.test(typeof this.onerror)&&this.onerror.apply(this.context,[a,this])},_close:function(a){clearTimeout(this.timeout),this.timeout=setTimeout(this._init.bind(this),5e3)},send:function(a){try{a=JSON.stringify(a)}catch(a){}if(1===this.ws.readyState)try{this.ws.send(a)}catch(b){this.q.push(a)}else this.q.push(a)}},a});