/*!
 * tiny-msg-client - version 0.4.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2016 Steve Ottoz
 */
(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports'],b);else if('undefined'!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.Msg=c.exports}})(this,function(a,b){'use strict';function c(n,o){if(!(n instanceof o))throw new TypeError('Cannot call a class as a function')}function d(){WebSocket&&(this.ws=new WebSocket(this.url,this.channel),this.ws.onopen=f.bind(this),this.ws.onmessage=g.bind(this),this.ws.onerror=h.bind(this),this.ws.onclose=j.bind(this))}function f(n){for(;this.q.length;)try{this.ws.send(this.q.shift())}catch(o){}}function g(n){var o=n.data;try{o=JSON.parse(o)}catch(p){}/^f/.test(k(this.onmsg))&&this.onmsg.apply(this.context,[o,n,this])}function h(n){/^f/.test(k(this.onerror))&&this.onerror.apply(this.context,[n,this])}function j(n){clearTimeout(this.timeout),this.timeout=setTimeout(this._init.bind(this),5000)}Object.defineProperty(b,'__esModule',{value:!0});var k='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&'function'==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?'symbol':typeof n},l=function(){function n(o,p){for(var q=0;q<p.length;q++){var r=p[q];r.enumerable=r.enumerable,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}return function(o,p,q){return p&&n(o.prototype,p),q&&n(o,q),o}}(),m=function(){function n(o,p,q){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:'';c(this,n),this.url=s,this.channel=o,this.onmsg=p,this.onerror=q,this.context=r,this.q=[],d.call(this)}return l(n,[{key:'send',value:function(p){try{p=JSON.stringify(p)}catch(q){}if(1===this.ws.readyState)try{this.ws.send(p)}catch(q){this.q.push(p)}else this.q.push(p)}}]),n}();b.default=m,a.exports=b['default']});