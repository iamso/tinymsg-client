/*!
 * tiny-msg-client - version 0.5.1
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2017 Steve Ottoz
 */
(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports'],b);else if('undefined'!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.Msg=c.exports}})(this,function(a,b){'use strict';function c(h,j){if(!(h instanceof j))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var d='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(h){return typeof h}:function(h){return h&&'function'==typeof Symbol&&h.constructor===Symbol&&h!==Symbol.prototype?'symbol':typeof h},f=function(){function h(j,k){for(var l=0;l<k.length;l++){var m=k[l];m.enumerable=m.enumerable,m.configurable=!0,'value'in m&&(m.writable=!0),Object.defineProperty(j,m.key,m)}}return function(j,k,l){return k&&h(j.prototype,k),l&&h(j,l),j}}(),g=function(){function h(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'';c(this,h),this.url=k,this.channel=j,this.handler={},this.q=[],this.init()}return f(h,[{key:'init',value:function(){return WebSocket?(this.ws=new WebSocket(this.url,this.channel),this.ws.onopen=this._onopen.bind(this),this.ws.onmessage=this._onmessage.bind(this),this.ws.onerror=this._onerror.bind(this),this.ws.onclose=this._onclose.bind(this),this):void(this.ws={readyState:0})}},{key:'send',value:function(k){try{k=JSON.stringify(k)}catch(l){}if(1===this.ws.readyState)try{this.ws.send(k)}catch(l){this.q.push(k)}else this.q.push(k);return this}},{key:'on',value:function(k,l){return Array.isArray(this.handler[k])||(this.handler[k]=[]),this.handler[k].push(l),this}},{key:'_onopen',value:function(k){for(;this.q.length;)try{this.ws.send(this.q.shift())}catch(l){}}},{key:'_onmessage',value:function(k){var l=k.data;try{l=JSON.parse(l)}catch(s){}if(Array.isArray(this.handler.message)){var m=!0,n=!1,o=void 0;try{for(var q,p=this.handler.message[Symbol.iterator]();!(m=(q=p.next()).done);m=!0){var r=q.value;/^f/.test('undefined'==typeof r?'undefined':d(r))&&r.apply(this,[k,l,this])}}catch(s){n=!0,o=s}finally{try{!m&&p.return&&p.return()}finally{if(n)throw o}}}}},{key:'_onerror',value:function(k){if(Array.isArray(this.handler.error)){var l=!0,m=!1,n=void 0;try{for(var p,o=this.handler.error[Symbol.iterator]();!(l=(p=o.next()).done);l=!0){var q=p.value;/^f/.test('undefined'==typeof q?'undefined':d(q))&&q.apply(this,[k,this])}}catch(r){m=!0,n=r}finally{try{!l&&o.return&&o.return()}finally{if(m)throw n}}}}},{key:'_onclose',value:function(k){clearTimeout(this.timeout),this.timeout=setTimeout(this.init.bind(this),5000)}}]),h}();b.default=g,a.exports=b['default']});